{% extends "base.html" %}

{% block title %}Login - EduTrack AI{% endblock %}

{% block content %}
<div id="loginApp" class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-lg border-0" style="border-radius: 15px;">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <i class="fas fa-graduation-cap fa-3x text-primary mb-3"></i>
                        <h3>Welcome Back</h3>
                        <p class="text-muted">Sign in to your account</p>
                    </div>
                    
                    <form @submit.prevent="login">
                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-user"></i>
                                </span>
                                <input 
                                    type="text" 
                                    class="form-control" 
                                    id="username" 
                                    v-model="credentials.username"
                                    required
                                    placeholder="Enter your username"
                                >
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="password" class="form-label">Password</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-lock"></i>
                                </span>
                                <input 
                                    :type="showPassword ? 'text' : 'password'" 
                                    class="form-control" 
                                    id="password" 
                                    v-model="credentials.password"
                                    required
                                    placeholder="Enter your password"
                                >
                                <button 
                                    type="button" 
                                    class="btn btn-outline-secondary"
                                    @click="showPassword = !showPassword"
                                >
                                    <i :class="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="alert alert-danger" v-if="errorMessage">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            {{ errorMessage }}
                        </div>
                        
                        <div class="d-grid mb-3">
                            <button type="submit" class="btn btn-custom" :disabled="loading">
                                <span v-if="loading">
                                    <i class="fas fa-spinner fa-spin me-2"></i>
                                    Signing in...
                                </span>
                                <span v-else>
                                    <i class="fas fa-sign-in-alt me-2"></i>
                                    Sign In
                                </span>
                            </button>
                        </div>
                    </form>
                    
                    <hr>
                    
                    <div class="text-center">
                        <h6 class="text-muted mb-3">Demo Accounts</h6>
                        <div class="row">
                            <div class="col-6">
                                <button 
                                    class="btn btn-outline-primary btn-sm w-100" 
                                    @click="setDemoCredentials('admin')"
                                >
                                    <i class="fas fa-user-shield me-1"></i>
                                    Admin
                                </button>
                            </div>
                            <div class="col-6">
                                <button 
                                    class="btn btn-outline-success btn-sm w-100" 
                                    @click="setDemoCredentials('counselor')"
                                >
                                    <i class="fas fa-chalkboard-teacher me-1"></i>
                                    Counselor
                                </button>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-12">
                                <button 
                                    class="btn btn-outline-info btn-sm w-100" 
                                    @click="setDemoCredentials('student')"
                                >
                                    <i class="fas fa-user-graduate me-1"></i>
                                    Student
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-4">
                <a href="/" class="text-decoration-none">
                    <i class="fas fa-arrow-left me-2"></i>
                    Back to Home
                </a>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp } = Vue;

createApp({
    data() {
        return {
            credentials: {
                username: '',
                password: ''
            },
            showPassword: false,
            loading: false,
            errorMessage: ''
        }
    },
    
    methods: {
        async login() {
            this.loading = true;
            this.errorMessage = '';
            
            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(this.credentials)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    window.location.href = data.redirect || '/dashboard';
                } else {
                    this.errorMessage = data.message || 'Login failed';
                }
            } catch (error) {
                console.error('Login error:', error);
                this.errorMessage = 'Connection error. Please try again.';
            } finally {
                this.loading = false;
            }
        },
        
        setDemoCredentials(type) {
            switch(type) {
                case 'admin':
                    this.credentials.username = 'admin';
                    this.credentials.password = 'admin123';
                    break;
                case 'counselor':
                    this.credentials.username = 'counselor';
                    this.credentials.password = 'counselor123';
                    break;
                case 'student':
                    this.credentials.username = 'student';
                    this.credentials.password = 'student123';
                    break;
            }
        }
    }
}).mount('#loginApp');
</script>
{% endblock %}
